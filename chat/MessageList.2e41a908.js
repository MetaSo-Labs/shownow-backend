var Es=Object.defineProperty,Ls=Object.defineProperties;var Ns=Object.getOwnPropertyDescriptors;var ha=Object.getOwnPropertySymbols;var Us=Object.prototype.hasOwnProperty,Hs=Object.prototype.propertyIsEnumerable;var fa=(S,E,R)=>E in S?Es(S,E,{enumerable:!0,configurable:!0,writable:!0,value:R}):S[E]=R,ya=(S,E)=>{for(var R in E||(E={}))Us.call(E,R)&&fa(S,R,E[R]);if(ha)for(var R of ha(E))Hs.call(E,R)&&fa(S,R,E[R]);return S},ka=(S,E)=>Ls(S,Ns(E));var q=(S,E,R)=>new Promise((Ue,Pe)=>{var He=K=>{try{xe(R.next(K))}catch(he){Pe(he)}},je=K=>{try{xe(R.throw(K))}catch(he){Pe(he)}},xe=K=>K.done?Ue(K.value):Promise.resolve(K.value).then(He,je);xe((R=R.apply(S,E)).next())});import{C as js,g4 as Xs,g5 as ba,d as le,aG as qs,N as Os,j as _,M as p,o as i,v as z,w as Q,S as ge,a as t,V as y,u as e,I as Fe,y as Vs,m as h,c as d,W as wa,e as _a,t as m,F as ce,b as v,X as pe,Y as Ca,R as Gs,g6 as Ws,$ as Js,aN as ze,a2 as Qs,i as Ia,f as Ma,g as Ta,cy as ve,di as Ys,d0 as Ks,df as De,dj as Zs,dk as el,dc as O,bd as j,r as al,T as tl,dg as Ee,dl as sl,Z as ll,dm as rl,bf as nl,cb as ol,bg as Sa,d3 as il,q as Fa,s as Da,cB as cl,_ as Le,n as We,a5 as Ne,an as dl,f5 as Je,f6 as ul,fJ as $a,eP as Pa,eR as ml,h as gl,bw as pl,g7 as vl,x as xl,k as hl,aa as $e,cI as Ba,aJ as fl,g8 as Aa,fw as yl,bJ as kl,be as bl,__tla as wl}from"./index.60c95b13.js";import{U as _l,_ as Ra,M as Cl,N as Il,a as Ml,P as Tl,__tla as Sl}from"./Publish.870a3d57.js";import{_ as Fl,__tla as Dl}from"./modals.40b81ca4.js";import{_ as $l,__tla as Pl}from"./ChannelBody.43c8774d.js";import{s as Bl}from"./sub-channel.b3a9a7fc.js";import{__tla as Al}from"./Sticker.24c3cd1f.js";import{__tla as Rl}from"./index.7b78b19f.js";import{__tla as zl}from"./popover.f9105e72.js";let za,El=Promise.all([(()=>{try{return wl}catch(S){}})(),(()=>{try{return Sl}catch(S){}})(),(()=>{try{return Dl}catch(S){}})(),(()=>{try{return Pl}catch(S){}})(),(()=>{try{return Al}catch(S){}})(),(()=>{try{return Rl}catch(S){}})(),(()=>{try{return zl}catch(S){}})()]).then(()=>q(void 0,null,function*(){const S=["light","dark"],E=js({title:{type:String,default:""},description:{type:String,default:""},type:{type:String,values:Xs(ba),default:"info"},closable:{type:Boolean,default:!0},closeText:{type:String,default:""},showIcon:Boolean,center:Boolean,effect:{type:String,values:S,default:"light"}}),R={close:s=>s instanceof MouseEvent},Ue=le({name:"ElAlert"}),Pe=le(ka(ya({},Ue),{props:E,emits:R,setup(s,{emit:x}){const c=s,{Close:D}=Ws,P=qs(),g=Os("alert"),C=_(!0),f=p(()=>ba[c.type]),te=p(()=>[g.e("icon"),{[g.is("big")]:!!c.description||!!P.default}]),F=p(()=>({[g.is("bold")]:c.description||P.default})),U=u=>{C.value=!1,x("close",u)};return(u,o)=>(i(),z(Ca,{name:e(g).b("fade"),persisted:""},{default:Q(()=>[ge(t("div",{class:y([e(g).b(),e(g).m(u.type),e(g).is("center",u.center),e(g).is(u.effect)]),role:"alert"},[u.showIcon&&e(f)?(i(),z(e(Fe),{key:0,class:y(e(te))},{default:Q(()=>[(i(),z(Vs(e(f))))]),_:1},8,["class"])):h("v-if",!0),t("div",{class:y(e(g).e("content"))},[u.title||u.$slots.title?(i(),d("span",{key:0,class:y([e(g).e("title"),e(F)])},[wa(u.$slots,"title",{},()=>[_a(m(u.title),1)])],2)):h("v-if",!0),u.$slots.default||u.description?(i(),d("p",{key:1,class:y(e(g).e("description"))},[wa(u.$slots,"default",{},()=>[_a(m(u.description),1)])],2)):h("v-if",!0),u.closable?(i(),d(ce,{key:2},[u.closeText?(i(),d("div",{key:0,class:y([e(g).e("close-btn"),e(g).is("customed")]),onClick:U},m(u.closeText),3)):(i(),z(e(Fe),{key:1,class:y(e(g).e("close-btn")),onClick:U},{default:Q(()=>[v(e(D))]),_:1},8,["class"]))],64)):h("v-if",!0)],2)],2),[[pe,C.value]])]),_:3},8,["name"]))}}));var He=Gs(Pe,[["__file","/home/runner/work/element-plus/element-plus/packages/components/alert/src/alert.vue"]]);const je=Js(He),xe={class:"animate-pulse flex space-x-4 w-full py-4"},K=t("div",{class:"h-0 w-1/5 w-2/5 w-3/5 w-4/5 w-5/5 hidden"},null,-1),he=t("div",{class:"rounded-3xl bg-gray-300 dark:bg-gray-600 h-13.5 w-13.5"},null,-1),Ea={class:"flex-1 space-y-4 py-1"},La=t("div",{class:"h-2.5 bg-gray-300 dark:bg-gray-600 rounded w-1/4 max-w-[200PX]"},null,-1),Na={class:"space-y-3"},Ua=t("div",{class:"grid grid-cols-4 gap-4"},[t("div",{class:"h-2.5 bg-gray-200 dark:bg-gray-700 rounded col-span-2"})],-1),Ha=t("div",{class:"h-2.5 bg-gray-300 dark:bg-gray-600 rounded w-1/4"},null,-1),ja=le({__name:"LoadingItem",setup(s){const x=p(()=>`w-${Math.floor(Math.random()*4)+1}/5`);return(c,D)=>(i(),d("div",xe,[K,he,t("div",Ea,[La,t("div",Na,[Ua,Ha,t("div",{class:y(["h-2.5 bg-gray-200 dark:bg-gray-700 rounded",e(x)])},null,2)])])]))}}),Xa={class:"overflow-x-hidden overflow-y-hidden py-4 space-y-4 px-4"},qa=le({__name:"LoadingList",props:{itemCount:{type:Number,default:6}},setup(s){const x=s,c=_([]);for(let D=1;D<=x.itemCount;D++)c.value.push(D);return(D,P)=>(i(),d("div",Xa,[(i(!0),d(ce,null,ze(c.value,g=>(i(),z(ja))),256))]))}}),Oa="/chat/red-envelope.f2e185e2.svg",Va=s=>(Fa("data-v-2900be94"),s=s(),Da(),s),Ga={class:"flex"},Wa={key:0,class:"w-full"},Ja={key:1,class:"my-1.5 flex"},Qa={key:2,class:"my-1.5 flex"},Ya={class:"max-w-full min-w-[240PX] md:w-[300PX] shadow rounded-xl rounded-tl bg-blue-400"},Ka={class:"rounded-xl p-4 flex space-x-4.5 bg-white dark:bg-gray-700 items-center rounded-tl border border-solid border-blue-400"},Za={class:"flex flex-col space-y-1.5"},et={class:"text-dark-800 dark:text-gray-100 text-base font-medium capitalize max-w-[160PX] truncate"},at={class:"text-dark-400 dark:text-gray-200 text-xs"},tt={class:"flex py-2.5 items-center space-x-1.5 px-4"},st={class:"text-white text-xs"},lt={key:3,class:"my-1.5 flex"},rt={class:"max-w-full min-w-[240PX] md:w-[300PX] shadow rounded-xl rounded-tl bg-blue-400"},nt={class:"rounded-xl p-4 flex space-x-4.5 bg-white dark:bg-gray-700 items-center rounded-tl border border-solid border-blue-400"},ot={class:"flex flex-col space-y-1"},it={class:"text-dark-800 dark:text-gray-100 text-base font-medium capitalize max-w-[160PX] truncate"},ct={key:0,class:"text-dark-400 dark:text-gray-200 text-xs"},dt={class:"flex py-2.5 items-center space-x-1.5 px-4"},ut={class:"text-white text-xs"},mt={key:4,class:"my-1.5 flex flex-col items-start"},gt={class:"max-w-full min-w-[240PX] md:w-[300PX] shadow rounded-xl rounded-tl bg-blue-400"},pt={class:"flex items-center gap-x-4.5 mb-3"},vt={class:"flex flex-col space-y-1"},xt={class:"text-dark-800 dark:text-gray-100 text-base font-medium capitalize max-w-[160PX] truncate"},ht={key:0,class:"text-dark-400 dark:text-gray-200 text-xs"},ft={class:"pt-3 flex justify-between items-center"},yt={class:"text-xs text-dark-300 dark:text-gray-400"},kt={class:"text-sm"},bt={class:"flex py-2.5 items-center space-x-1.5 px-4"},wt={class:"text-white text-xs"},_t={class:"mt-1.5 bg-dark-800/5 dark:bg-gray-800 text-sm text-dark-400 dark:text-gray-200 rounded-xl px-3 py-2"},Ct={key:5,class:"my-1.5 flex flex-col items-start"},It={key:0,class:"mt-1.5 bg-dark-800/5 dark:bg-gray-800 text-sm text-dark-400 dark:text-gray-200 rounded-xl px-3 py-2"},Mt={key:6,class:"my-1.5 flex flex-col items-start"},Tt={key:0,class:"mt-1.5 bg-dark-800/5 dark:bg-gray-800 break-all text-sm text-dark-400 dark:text-gray-200 rounded-xl px-3 py-2"},St={key:7,class:"my-1.5 flex flex-col items-start"},Ft={key:8,class:"my-1.5 flex flex-col items-start"},Dt={class:"mt-1.5 bg-dark-800/5 dark:bg-gray-800 break-all text-sm text-dark-400 dark:text-gray-200 rounded-xl px-3 py-2"},$t=["title"],Pt={key:10,class:"text-xs text-dark-400 dark:text-gray-200 my-0.5 capitalize"},Bt={class:"max-w-full md:max-w-[50%] lg:max-w-[400px] shadow-lg rounded-xl cursor-pointer origin-top-left hover:shadow-xl hover:scale-105 transition-all duration-300"},At={class:"rounded-xl bg-red-400 p-6 flex space-x-2"},Rt=["src"],zt={class:""},Et={class:"text-white text-lg font-medium capitalize"},Lt={class:"text-red-50 text-xs mt-0.5"},Nt=Va(()=>t("div",{class:"py-2 px-6 text-dark-400 dark:text-gray-200 text-xs"},"Show\u7EA2\u5305",-1)),Ut={class:"p-4 space-y-3"},Ht={class:"flex items-center space-x-3"},jt={class:""},Xt={class:"flex-1 min-w-0"},qt={class:"text-dark-800 dark:text-gray-100 font-medium text-base truncate max-w-[200px]"},Ot={class:"text-dark-400 dark:text-gray-400 text-sm"},Vt={class:"flex gap-4 items-center"},Gt={class:"text-dark-400 dark:text-gray-400 text-xs mt-1 truncate max-w-[150px]"},Wt={key:0,class:"text-dark-400 dark:text-gray-400 text-xs mt-1"},Jt={class:"pt-2 border-t border-gray-200 dark:border-gray-600"},Qt={class:"main-border bg-primary hover:bg-primary-dark text-black text-center py-2 px-4 rounded-lg transition-colors duration-200 font-medium"},Yt=["innerHTML"],Kt={class:"text-xxs text-dark-300 dark:text-gray-400 mt-1 underline"},Zt=["innerHTML"],es={key:0,class:"animate-spin rounded-full h-4 w-4 border-b-2 border-gray-700 inline-block opacity-50"},as=["title"],ts={key:0,class:"text-[#fc457b] flex-1 font-sm mr-2"},ss=le({__name:"MessageItemForSession",props:{message:null,lastReadIndex:null},emits:["quote","toBuzz","to-time-stamp"],setup(s,{emit:x}){const c=s,D=Qs("Reply"),P=Ia();Ma();const g=_(!1),C=_(null),f=_(null);function te(a){x("to-time-stamp",a)}const F=Ta(),U=Ma(),u=ve(),o=p(()=>u.activeChannel);Ys();const I=Ks(),V=_("hidden"),re=_("");p(()=>{var a,r,k;return c.message.from===((a=F.user)==null?void 0:a.metaId)?(r=F.user)==null?void 0:r.name:(k=o.value)==null?void 0:k.name});const B=p(()=>c.message.chain);p(()=>{var a,r,k;return c.message.from===((a=F.user)==null?void 0:a.metaId)?(r=F.user)==null?void 0:r.metaName:(k=o.value)==null?void 0:k.metaName});const ne=p(()=>P.t("Talk.Messages.resend")),se=p(()=>{const a=De(c.message.content,c.message.encryption,c.message.protocol,c.message.isMock,!0),r=/\/channels\/public\/([a-f0-9]+)/i,k=/\/channels\/public\/([a-f0-9]+i0)(?:\/([a-f0-9]+))?/i,H=r.test(a),w=k.test(a);if(H&&!C.value){const N=a.match(r);if(N){const ae=N[1];W(ae+"i0")}if(w&&!f.value){const ae=a.match(k);if(ae){const me=ae[1];X(me)}}}return H}),Z=a=>{const r=a.target;if(r.tagName==="A"&&r.classList.contains("webview-link")){a.preventDefault();const k=r.getAttribute("data-webview-url");k&&rl({url:k})}},W=a=>q(this,null,function*(){try{const r=yield Zs(a);C.value=r,console.log("Fetched channel info:",r)}catch(r){console.error("Failed to fetch channel info:",r)}}),X=a=>q(this,null,function*(){try{const r=yield el({groupId:a});r.data.list.length&&(f.value=r.data.list[0])}catch(r){}}),J=()=>{const a=A.value;a.fullUrl&&window.open(a.fullUrl,"_self")},A=p(()=>{var N,ae,me,we,_e,Ce,Ie,Me,Te,Se;const a=De(c.message.content,c.message.encryption,c.message.protocol,c.message.isMock,!0),r=/\/channels\/public\/([a-f0-9]+)/i,k=/\/channels\/public\/([a-f0-9]+i0)(?:\/([a-f0-9]+))?/i,H=a.match(r),w=a.match(k);return H&&!w[2]?{pinId:H[1]+"i0",groupName:(N=C.value)==null?void 0:N.roomName,groupAvatar:((ae=C.value)==null?void 0:ae.roomIcon)||"",memberCount:((me=C.value)==null?void 0:me.userCount)||0,fullUrl:a,creator:((_e=(we=C.value)==null?void 0:we.createUserInfo)==null?void 0:_e.name)||""}:w[2]?(console.log("subChannleMatch",a),{pinId:w[2]+"i0",groupName:(Ce=f.value)==null?void 0:Ce.channelName,groupAvatar:((Ie=f.value)==null?void 0:Ie.channelIcon)||"",memberCount:((Me=C.value)==null?void 0:Me.userCount)||0,fullUrl:a,creator:((Se=(Te=C.value)==null?void 0:Te.createUserInfo)==null?void 0:Se.name)||""}):{pinId:"",groupName:"Group Chat",groupAvatar:"",memberCount:0,creator:"",fullUrl:a}}),de=()=>q(this,null,function*(){}),oe=p(()=>u.activeChannel.publicKeyStr),fe=p(()=>{var a,r;if(console.log("props.message.content",c.message),c.message.isMock)return c.message.content;if(c.message.encryption!=="1")return((a=c.message.data)==null?void 0:a.attachment)||((r=c.message)==null?void 0:r.content)}),Be=(a,r)=>q(this,null,function*(){try{const k=yield cl.getMetaFileData(a,235,!0,r);return URL.createObjectURL(k.data)}catch(k){}}),Ae=a=>q(this,null,function*(){const r=yield Be(a,oe.value);I.images=[r],I.index=0,I.visibale=!0}),ye=a=>{if(typeof a>"u")return"";const r=/<\/?.+?>/gi,k=/document\.cookie/gi,H=/(http|https):\/\//gi,w=/(f|ht){1}(tp|tps):\/\/([\w-]+\S)+[\w-]+([\w-?%#&=]*)?(\/[\w- ./?%#&=]*)?/g;return r.test(a)?"\u65E0\u6548\u8F93\u5165,\u522B\u800D\u82B1\u6837!":k.test(a)?"\u65E0\u6548\u8F93\u5165,\u4F60\u60F3\u5E72\u561B!":(a=a.replace(w,function(N){return H.test(a)?U.isWebView?`<a href="javascript:void(0);" data-webview-url="${N}" class="url webview-link" style="text-decoration: underline;cursor: pointer;word-break: break-all;"> ${N} </a>`:`<a href=${N} target="${ee()}" style="text-decoration: underline;cursor: pointer;word-break: break-all;" class="url"> ${N} </a>`:U.isWebView?`<a href="javascript:void(0);" data-webview-url="http://${a}" class="webview-link" style="text-decoration: underline;cursor: pointer;word-break: break-all;">${a}</a>`:`<a onClick="window.open('http://${a}','${ee()}')" style="text-decoration: underline;cursor: pointer;word-break: break-all;" target="${ee()}">${a}</a>`}),a=a.replace(/\\n/g,`
`),a.replace(/\n/g,"<br />"))},ee=()=>U.isWebView?"_self":window.innerWidth>768?"_blank":"_self",ie=p(()=>{var H;const a=c.message.content;if(!a)return"";if(c.message.metaId===((H=c.message.data)==null?void 0:H.redEnvelopeMetaId))return P.t("Talk.Channel.receive_own_red_envelope");const[r,k]=a.split("|-|");return P.t("Talk.Channel.receive_red_envelope",{sender:k})}),Xe=p(()=>{var a;return((a=c.message.data)==null?void 0:a.content)||P.t("Talk.Channel.default_red_envelope_message")}),M=p(()=>{var a,r;return((a=F.last)==null?void 0:a.metaid)&&((r=F.last)==null?void 0:r.metaid)===c.message.from}),qe=p(()=>{var a,r,k;return c.message.from===((a=F.last)==null?void 0:a.metaid)?(r=F.last)==null?void 0:r.avatar:(k=o.value)==null?void 0:k.avatar}),Oe=p(()=>{var a,r,k,H;if((r=(a=c.message.data)==null?void 0:a.sellUtxo)!=null&&r.price){let w=(((H=(k=c.message.data)==null?void 0:k.sellUtxo)==null?void 0:H.price)/1e8).toFixed(8);return w=w.replace(/0+$/,""),w=w+" SPACE",w}return"-"}),Ve=p(()=>O(c.message.protocol,j.SimpleEmojiGroupChat)),ke=p(()=>O(c.message.protocol,j.SimpleFileMsg)),be=p(()=>O(c.message.protocol,j.SimpleGroupLuckyBag)),Ge=p(()=>O(c.message.protocol,j.OpenRedenvelope)),Re=p(()=>O(c.message.protocol,j.SimpleMsg)),l=p(()=>O(c.message.protocol,j.PayLike)),n=p(()=>O(c.message.protocol,j.PayFollow)),b=p(()=>O(c.message.protocol,j.SimpleRePost)),T=p(()=>O(c.message.nodeName,j.SimpleMicroblog)),L=p(()=>O(c.message.protocol,j.PayComment)),$=p(()=>O(c.message.protocol,j.FtTransfer)),Y=p(()=>O(c.message.protocol,j.NftTransfer)),ue=p(()=>O(c.message.protocol,j.nftBuy));return(a,r)=>{var we,_e,Ce,Ie,Me,Te,Se,Ye,Ke,Ze,ea,aa,ta,sa,la,ra,na,oa,ia,ca,da,ua,ma,ga,pa,va,xa;const k=nl,H=ol,w=Sa,N=il,ae=al("RouterLink"),me=Fl;return i(),d("div",{class:y(["lg:hover:bg-gray-200 lg:dark:hover:bg-gray-950 px-4 py-1.5 relative group transition-all duration-150",{replying:((we=e(D).val)==null?void 0:we.timestamp)===s.message.timestamp}])},[c.lastReadIndex!==void 0&&s.message.index===c.lastReadIndex+1?(i(),z(_l,{key:0,id:"unread-divider"})):h("v-if",!0),h(" \u6D88\u606F\u83DC\u5355 "),e(Re)?(i(),z(Ra,{key:1,message:c.message,parsed:ye(e(De)((_e=s.message)==null?void 0:_e.content,(Ce=s.message)==null?void 0:Ce.encryption,(Ie=s.message)==null?void 0:Ie.protocol,(Me=s.message)==null?void 0:Me.isMock,!0)),translateStatus:V.value,"onUpdate:translateStatus":r[0]||(r[0]=G=>V.value=G),translatedContent:re.value,"onUpdate:translatedContent":r[1]||(r[1]=G=>re.value=G),onQuote:r[2]||(r[2]=G=>x("quote",G)),onToBuzz:r[3]||(r[3]=G=>x("toBuzz",G)),isMyMessage:e(M)},null,8,["message","parsed","translateStatus","translatedContent","isMyMessage"])):(i(),z(Ra,{key:2,isMyMessage:e(M),message:c.message,onQuote:r[4]||(r[4]=G=>x("quote",G)),onToBuzz:r[5]||(r[5]=G=>x("toBuzz",G))},null,8,["isMyMessage","message"])),h(" Quout "),s.message.replyInfo?(i(),z(Cl,tl({key:3,quote:{avatarImage:(Se=(Te=s.message.replyInfo)==null?void 0:Te.userInfo)==null?void 0:Se.avatarImage,metaName:"",metaId:(Ke=(Ye=s.message.replyInfo)==null?void 0:Ye.userInfo)==null?void 0:Ke.metaid,nickName:(Ze=s.message.replyInfo.userInfo)==null?void 0:Ze.name,protocol:s.message.replyInfo.protocol,content:(e(O)(s.message.replyInfo.protocol,e(j).SimpleFileMsg),s.message.replyInfo.content),encryption:s.message.replyInfo.encryption,timestamp:s.message.replyInfo.timestamp,isMock:s.message.isMock,index:s.message.replyInfo.index},isSession:!0},a.$attrs,{isMyMessage:e(M),onToTimeStamp:te}),null,16,["quote","isMyMessage"])):h("v-if",!0),t("div",{class:y(["flex",[e(M)?"flex-row-reverse":""]])},[v(k,{image:e(qe),"meta-id":"undefined",name:(aa=(ea=s.message)==null?void 0:ea.fromUserInfo)==null?void 0:aa.name,"meta-name":"",class:"w-10 h-10 lg:w-13.5 lg:h-13.5 shrink-0 select-none",disabled:!0},null,8,["image","name"]),t("div",{class:y(["grow",[e(M)?"mr-2 lg:mr-4 pl-8 lg:pl-12":"ml-2 lg:ml-4 pr-8 lg:pr-12"]])},[t("div",{class:y(["flex space-x-2",[e(M)?"flex-row-reverse items-center":"items-baseline"]])},[v(H,{name:(sa=(ta=s.message)==null?void 0:ta.fromUserInfo)==null?void 0:sa.name,"meta-name":"","text-class":"text-sm font-medium dark:text-gray-100",class:y([e(M)?"ml-2":""])},null,8,["name","class"]),t("div",{class:y(["text-xs shrink-0 flex whitespace-nowrap items-center",[e(M)?"flex-row-reverse  justify-center":"gap-1 ",e(B)==e(Ee).btc?"text-[#EBA51A]":"text-dark-300 dark:text-gray-400"]])},[t("span",null,m(e(sl)(s.message.timestamp,e(P))),1),t("div",Ga,[e(B)==e(Ee).btc?(i(),z(w,{key:0,name:"btc",class:y(["chain-icon-menu w-[16px] h-[16px]",e(M)?"mr-1":""])},null,8,["class"])):h("v-if",!0),h(` <img
              :src="btcIcon"
              
             
              
            /> `)])],2)],2),e(Ve)?(i(),d("div",Wa,[v(N,{src:e(De)((la=s.message)==null?void 0:la.content,(ra=s.message)==null?void 0:ra.encryption,(na=s.message)==null?void 0:na.protocol,(oa=s.message)==null?void 0:oa.isMock,!0),customClass:"max-w-[80%] md:max-w-[50%] lg:max-w-[320px] py-0.5 object-scale-down"},null,8,["src"]),v(Il,{class:"w-8 mt-1"})])):e(n)?(i(),d("div",Ja,[t("div",{class:y(["text-sm text-dark-800 dark:text-gray-100 font-normal break-all p-3 rounded-xl rounded-tl flex items-center",e(M)?"bg-primary dark:text-gray-800":"bg-white dark:bg-gray-700"])},[v(w,{name:"message_follow",class:"w-4 h-4 mr-1.5"}),t("span",null,m(a.$t("Talk.Messages.follow")),1)],2)])):e($)?(i(),d("div",Qa,[t("div",Ya,[t("div",Ka,[v(N,{src:s.message.icon,customClass:"h-15 w-15 rounded-md shrink-0",loading:"lazy"},null,8,["src"]),t("div",Za,[t("div",et,m(s.message.memo),1),t("div",at,m(s.message.amountStr.split(".")[0]+" "+s.message.symbol),1)])]),t("div",tt,[v(w,{name:"message_token",class:"w-4 h-4 text-white"}),t("div",st,m(a.$t("Talk.Messages.token_transfer")),1)])])])):e(Y)?(i(),d("div",lt,[t("div",rt,[t("div",nt,[v(N,{src:s.message.icon,customClass:"h-15 w-15 rounded-md shrink-0",loading:"lazy"},null,8,["src"]),t("div",ot,[t("div",it,m(s.message.memo),1),s.message.data?(i(),d("div",ct," # "+m(s.message.data.tokenIndex),1)):h("v-if",!0)])]),t("div",dt,[v(w,{name:"message_token",class:"w-4 h-4 text-white"}),t("div",ut,m(a.$t("Talk.Messages.nft_transfer")),1)])])])):e(ue)?(i(),d("div",mt,[t("div",gt,[v(ae,{to:{name:"nftDetail",params:{tokenIndex:s.message.data.tokenIndex,genesis:(ia=s.message.data)==null?void 0:ia.genesis,codehash:(ca=s.message.data)==null?void 0:ca.codehash,chain:"mvc"}},class:"block rounded-xl p-4 bg-white dark:bg-gray-700 rounded-tl border border-solid border-blue-400 divide-y divide-dark-200 dark:divide-gray-600"},{default:Q(()=>[t("div",pt,[v(N,{src:s.message.icon,customClass:"h-15 w-15 rounded-md shrink-0",loading:"lazy"},null,8,["src"]),t("div",vt,[t("div",xt,m(s.message.memo),1),s.message.data?(i(),d("div",ht," # "+m(s.message.data.tokenIndex),1)):h("v-if",!0)])]),t("div",ft,[t("div",yt,m(a.$t("Talk.Messages.price")),1),t("div",kt,m(e(Oe)),1)])]),_:1},8,["to"]),t("div",bt,[v(w,{name:"message_token",class:"w-4 h-4 text-white"}),t("div",wt,m(a.$t("Talk.Messages.nft_buy")),1)])]),t("div",_t,m(a.$t("Talk.Messages.buy_tip")),1)])):e(b)?(i(),d("div",Ct,[t("div",{class:y(["text-sm text-dark-800 dark:text-gray-100 font-normal break-all p-3 rounded-xl rounded-tl flex items-center",e(M)?"bg-primary dark:text-gray-800":"bg-white dark:bg-gray-700"])},[v(w,{name:"message_repost",class:"w-4 h-4 mr-1.5"}),t("span",null,m(a.$t("Talk.Messages.repost")),1)],2),s.message.data.rePostComment?(i(),d("div",It,m(s.message.data.rePostComment),1)):h("v-if",!0)])):e(T)?(i(),d("div",Mt,[t("div",{class:y(["text-sm text-dark-800 dark:text-gray-100 font-normal break-all p-3 rounded-xl rounded-tl flex items-center",e(M)?"bg-primary dark:text-gray-800":"bg-white dark:bg-gray-700"])},[v(w,{name:"message_repost",class:"w-4 h-4 mr-1.5"}),t("span",null,m(a.$t("Talk.Messages.repost_with_comment")),1)],2),s.message.data.content?(i(),d("div",Tt,m(s.message.data.content),1)):h("v-if",!0)])):e(l)?(i(),d("div",St,[t("div",{class:y(["text-sm text-dark-800 dark:text-gray-100 font-normal break-all p-3 rounded-xl rounded-tl flex items-center",e(M)?"bg-primary dark:text-gray-800":"bg-white dark:bg-gray-700"])},[v(w,{name:"message_like",class:"w-4 h-4 mr-1.5"}),t("span",null,m(a.$t("Talk.Messages.like")),1)],2)])):e(L)?(i(),d("div",Ft,[t("div",{class:y(["text-sm text-dark-800 dark:text-gray-100 font-normal break-all p-3 rounded-xl rounded-tl flex items-center",e(M)?"bg-primary dark:text-gray-800":"bg-white dark:bg-gray-700"])},[v(w,{name:"message_comment",class:"w-4 h-4 mr-1.5"}),t("span",null,m(a.$t("Talk.Messages.comment")),1)],2),t("div",Dt,m(s.message.data.content),1)])):e(ke)?(i(),d("div",{key:9,class:y(["w-full py-0.5 flex items-center",[e(M)?"flex-row-reverse":""]])},[t("div",{class:y(["w-fit max-w-[90%] md:max-w-[50%] lg:max-w-[235PX] max-h-[600PX] overflow-y-hidden rounded bg-transparent cursor-pointer transition-all duration-200",[s.message.error&&"opacity-50"]]),onClick:r[6]||(r[6]=G=>Ae(e(fe)))},[v(N,{src:e(fe),isPrivateChat:!0,chatPubkeyForDecrypt:e(oe),customClass:"rounded py-0.5 object-scale-down"},null,8,["src","chatPubkeyForDecrypt"])],2),s.message.error?(i(),d("button",{key:0,class:"ml-3",title:e(ne),onClick:de},[v(w,{name:"arrow_path",class:"w-4 h-4 text-dark-400 dark:text-gray-200 hover:animate-spin-once"})],8,$t)):h("v-if",!0),e(ke)&&g.value?(i(),z(ll,{key:1,to:"body"},[g.value?(i(),z($l,{key:0,src:s.message.content,isPrivateChat:!0,chatPubkeyForDecrypt:e(oe),onClose:r[7]||(r[7]=G=>g.value=!1)},null,8,["src","chatPubkeyForDecrypt"])):h("v-if",!0)])):h("v-if",!0)],2)):e(Ge)?(i(),d("div",Pt,m(e(ie)),1)):e(be)?(i(),d("div",{key:11,class:y(["w-full flex py-0.5",[e(M)?"flex-row-reverse":""]])},[t("div",Bt,[t("div",At,[t("img",{src:e(Oa),class:"h-12",loading:"lazy"},null,8,Rt),t("div",zt,[t("div",Et,m(a.$t("Talk.Channel.come_get_red_envelope")),1),t("div",Lt,m(e(Xe)),1)])]),Nt])],2)):e(se)?(i(),d(ce,{key:12},[h(" \u7FA4\u804A\u9080\u8BF7\u94FE\u63A5 "),t("div",{class:y(["w-full flex py-0.5",[e(M)?"flex-row-reverse":""]])},[t("div",{class:"max-w-full sm:max-w-[300px] shadow rounded-xl cursor-pointer transition-all duration-200 bg-white dark:bg-gray-700 hover:shadow-md group",onClick:J},[t("div",Ut,[h(" \u7FA4\u5934\u50CF\u548C\u57FA\u672C\u4FE1\u606F "),t("div",Ht,[t("div",jt,[v(me,{src:e(A).groupAvatar,alt:e(A).groupName,"custom-class":"w-12 h-12 min-w-12 min-h-12 rounded-full",size:48},null,8,["src","alt"])]),t("div",Xt,[t("div",qt,m(e(A).groupName||"Group Chat"),1),t("div",Ot,m(((da=c.message.userInfo)==null?void 0:da.name)||"Someone")+" "+m(a.$t("share_group_invites")),1)])]),t("div",Vt,[t("div",Gt,m(a.$t("share_group_creator"))+": "+m(e(A).creator),1),e(A).memberCount>0?(i(),d("div",Wt,m(a.$t("share_group_member"))+": "+m(e(A).memberCount),1)):h("v-if",!0)]),h(" \u67E5\u770B\u7FA4\u7EC4\u6309\u94AE "),t("div",Jt,[t("div",Qt,m(a.$t("share_group_view")),1)])])])],2)],2112)):(i(),d("div",{key:13,class:y(["my-1.5 max-w-full flex",[e(M)?"flex-row-reverse":""]])},[V.value==="showing"?(i(),d("div",{key:0,class:y(["text-sm text-dark-800 dark:text-gray-100 font-normal p-3 rounded-xl transition-all duration-200",[e(B)==e(Ee).btc&&"btc-item",e(M)?"bg-primary dark:text-gray-800 rounded-tr":"not-mine bg-white dark:bg-gray-700 rounded-tl",s.message.error&&"bg-red-200 dark:bg-red-700 opacity-50"]]),onClick:Z},[t("div",{class:"",innerHTML:re.value},null,8,Yt),t("div",Kt,m(a.$t("Talk.Messages.translated")),1)],2)):(i(),d("div",{key:1,class:y(["flex items-center gap-2 text-sm text-dark-800 dark:text-gray-100 font-normal p-3 rounded-xl transition-all duration-200",[e(B)==e(Ee).btc&&"btc-item",e(M)?"bg-primary dark:text-gray-800 rounded-tr":"not-mine bg-white dark:bg-gray-700 rounded-tl",s.message.error&&"bg-red-200 dark:bg-red-700 opacity-50"]]),onClick:Z},[t("div",{class:"whitespace-pre-wrap",innerHTML:ye(e(De)((ua=s.message)==null?void 0:ua.content,(ma=s.message)==null?void 0:ma.encryption,(ga=s.message)==null?void 0:ga.protocol,(pa=s.message)==null?void 0:pa.isMock,!0))},null,8,Zt),s.message.mockId&&!s.message.error?(i(),d("div",es)):h("v-if",!0)],2)),s.message.error?(i(),d("button",{key:2,class:"ml-3 break-words flex items-center justify-center",title:e(ne),onClick:de},[(va=s.message)!=null&&va.error?(i(),d("span",ts,m((xa=s.message)==null?void 0:xa.error),1)):h("v-if",!0),v(w,{name:"arrow_path",class:"w-4 h-4 flex-1 text-dark-400 dark:text-gray-200 hover:animate-spin-once"})],8,as)):h("v-if",!0)],2))],2)],2)],2)}}}),ls=Le(ss,[["__scopeId","data-v-2900be94"]]),rs={class:"broadcast-chat-header bg-white dark:bg-gray-700 text-dark-800 dark:text-white"},ns=["onClick"],os={class:"broadcast-icon"},is=["src"],cs={class:"broadcast-content"},ds={class:"broadcast-title text-base"},us={key:0,class:"broadcast-description text-xs flex items-center"},ms={class:"text-dark-300 dark:text-gray-400"},gs={class:"text-dark-300 dark:text-gray-400"},ps={class:"flex flex-row items-center gap-7"},vs={class:y(["main-border","primary"])},xs={key:1,class:y(["main-border","primary"])},hs=le({__name:"BroadcastChatHeader",setup(s){const x=ve(),c=We(),D=Ia(),P=_(!1),g=p(()=>x.currSubChannels),C=p(()=>{var u,o,I;return((u=x.activeChannel)==null?void 0:u.type)==="sub-group"?x.getOneChannelMuteStatus((o=x.activeChannel)==null?void 0:o.parentGroupId):x.getOneChannelSubHeaderShowStatus((I=x.activeChannel)==null?void 0:I.id)});function f(u){u.stopPropagation(),x.updateShowSubChannelHeader({groupId:x.activeChannel.id,status:!1})}const te=(u,o,I)=>{let V=(I==null?void 0:I.substring(0,16))||"";switch(u){case Je.msg:return ul(o,V);case Je.red:return o;case Je.img:return`[${D.t("new_msg_img")}]`;default:return""}},F=u=>{c.push({name:"talkChannel",params:{communityId:"public",channelId:x.activeChannel.id,subId:u}})},U=u=>{if(!u.lastMessage||typeof u.lastMessage.index!="number")return console.log("No lastMessage or invalid index for channel:",u.id),0;x.getLastReadIndex(u.id).then(o=>{var V;const I=+u.lastMessage.index-+o;return I>0&&((V=u.lastMessage)==null?void 0:V.sender)==u.createdBy?P.value=!0:P.value=!1,Math.max(0,I)}).catch(()=>0)};return Ne(()=>P.value,u=>{var o,I;u&&((o=x.activeChannel)==null?void 0:o.type)!=="sub-group"&&x.updateShowSubChannelHeader({groupId:(I=x.activeChannel)==null?void 0:I.id,status:!0})}),(u,o)=>{const I=Sa,V=$a,re=Fe;return ge((i(),d("div",rs,[(i(!0),d(ce,null,ze(e(g),B=>{var ne,se,Z,W,X,J;return i(),d("div",{class:"broadcast-chat-container",key:B.id,onClick:A=>F(B.id)},[t("div",os,[t("img",{src:e(Bl),alt:""},null,8,is)]),t("div",cs,[t("div",ds,m(B.name||"# Broadcast Chat"),1),(ne=B.lastMessage)!=null&&ne.sender?(i(),d("div",us,[t("span",ms,m(((se=B.lastMessage)==null?void 0:se.senderName)||((W=(Z=B.lastMessage)==null?void 0:Z.sender)==null?void 0:W.slice(0,6))||"")+":",1),t("span",gs,m(te((X=B.lastMessage)==null?void 0:X.type,(J=B.lastMessage)==null?void 0:J.content,B.id)),1)])):h("v-if",!0)]),t("div",ps,[U(B)>0?(i(),z(V,{key:0,value:U(B),class:"item",max:9999,"show-zero":!1},{default:Q(()=>[t("div",vs,[v(I,{name:"arrow_right",class:"cursor-pointer hover:text-gray-700 w-8 h-8"})])]),_:2},1032,["value"])):(i(),d("div",xs,[v(I,{name:"arrow_right",class:"cursor-pointer hover:text-gray-700 w-8 h-8"})])),t("div",{onClick:f,class:"flex z-[999] w-7 h-7 cursor-pointer hover:scale-105 items-center justify-center"},[v(re,{size:28},{default:Q(()=>[v(e(dl))]),_:1})])])],8,ns)}),128))],512)),[[pe,e(g).length>0&&e(C)]])}}}),fs=Le(hs,[["__scopeId","data-v-fed8cc51"]]),ys={class:"broadcast-chat-container"},ks={class:"broadcast-icon hover:scale-110"},bs={class:"broadcast-content"},ws={class:"broadcast-title text-base flex items-start flex-col"},_s={key:0,class:"text-xs text-dark-300 drak:text-dark-400"},Cs=le({__name:"BroadcastChatHeaderBack",setup(s){const x=ve(),{activeChannel:c}=Pa(ve()),D=We();p(()=>(console.log("simpleTalkStore.currSubChannels",x.currSubChannels),x.currSubChannels));const P=()=>{D.push({name:"talkChannel",params:{communityId:"public",channelId:x.activeChannel.parentGroupId}})},g=p(()=>x.getParentGroupChannel(c.value.id)),C=p(()=>g.value&&g.value.lastMessage&&typeof g.value.lastMessage.index=="number"&&typeof g.value.lastReadIndex=="number"&&g.value.lastMessage.index-g.value.lastReadIndex>0?g.value.lastMessage.index-g.value.lastReadIndex:0);return(f,te)=>{var U;const F=Fe;return((U=e(x).activeChannel)==null?void 0:U.type)==="sub-group"?(i(),d("div",{key:0,class:"broadcast-chat-header bg-white dark:bg-gray-700 text-dark-800 dark:text-white",onClick:P},[t("div",ys,[t("div",ks,[v(F,null,{default:Q(()=>[v(e(ml))]),_:1})]),t("div",bs,[t("div",ws,[t("span",null,m(f.$t("sub_channel_back_main")),1),e(C)?(i(),d("span",_s,m(e(C))+" "+m(f.$t("sub_channel_header_message")),1)):h("v-if",!0)])])])])):h("v-if",!0)}}}),Is=Le(Cs,[["__scopeId","data-v-63274a5a"]]),Qe=s=>(Fa("data-v-d2ea2ab8"),s=s(),Da(),s),Ms={class:"mask bg-gray-200 dark:bg-gray-900"},Ts={class:"app-container"},Ss={class:"loader"},Fs=Qe(()=>t("div",{class:"spinner"},null,-1)),Ds=[Fs],$s={class:"w-10 h-10 min-h-10 min-w-10 bg-white dark:bg-gray-700 shadow-md rounded-full flex items-center justify-center"},Ps={key:1,class:"w-10 h-10 min-h-10 min-w-10 bg-white dark:bg-gray-700 shadow-md rounded-full flex items-center justify-center"},Bs={class:"loader"},As=Qe(()=>t("div",{class:"spinner"},null,-1)),Rs=[As],zs=le({__name:"MessageList",props:{isSendRedPacketinProgress:Boolean},emits:["quote"],setup(s,{expose:x,emit:c}){const D=_(!1),P=_(!1),g=_(!1),C=_(!1),f=_(null),te=_(null),F=_(null);_(0);const U=_(0),u=Ta(),o=ve(),I=gl();We();const V=_(!1);pl();const re=_(""),B=_(),ne=vl(),se=_();xl();const Z=_(!1),W=_(-1),{activeChannel:X}=Pa(ve()),J=_(new Map),A=_(null),de=p(()=>{var n,b,T;const l=(n=o.activeChannelMessages[o.activeChannelMessages.length-1])==null?void 0:n.index;return console.log("maxIndex",l,(T=(b=o.activeChannel)==null?void 0:b.lastMessage)==null?void 0:T.index),!!(o.activeChannel&&o.activeChannel.lastMessage&&o.activeChannel.lastMessage.index&&o.activeChannel.lastMessage.index-l>2)}),oe=()=>q(this,null,function*(){(ie.value>0||de.value)&&(console.log("\u6EDA\u52A8\u5230\u5E95\u90E8\u5E76\u52A0\u8F7D\u6700\u65B0\u6D88\u606F",ie.value>0,de.value),yield o.loadNewestMessages(o.activeChannelId),yield $e(),yield yl(100)),f.value&&(f.value.scrollTop=0)}),fe=(l,n)=>{l&&l.$el?J.value.set(n.index||0,l.$el):l&&J.value.set(n.index||0,l)},Be=()=>{A.value&&A.value.disconnect(),A.value=new IntersectionObserver(l=>{l.forEach(n=>{var b;if(n.isIntersecting){const T=n.target,L=parseInt(T.getAttribute("data-message-index")||"0");if(o.activeChannelId&&L>=0&&!o.isSetActiveChannelIdInProgress){const $=(b=o.activeChannelMessages.find(Y=>Y.index===L))==null?void 0:b.timestamp;console.log(`\u{1F4D6} \u6D88\u606F ${L} \u8FDB\u5165\u89C6\u56FE\uFF0C\u66F4\u65B0\u5DF2\u8BFB\u7D22\u5F15${$?` (\u65F6\u95F4\u6233: ${new Date($).toLocaleString()})`:""}`),o.setLastReadIndex(o.activeChannelId,L,$).catch(Y=>{console.warn("\u274C \u66F4\u65B0\u5DF2\u8BFB\u7D22\u5F15\u5931\u8D25:",Y)})}else console.log("\u{1F3AF} \u9891\u9053\u5207\u6362\u4E2D\u4F46\u65E0\u6D88\u606F\uFF0C\u6216 lastReadIndex \u672A\u5B9A\u4E49\uFF0C\u8DF3\u8FC7\u66F4\u65B0\u5DF2\u8BFB\u7D22\u5F15")}})},{root:f.value,rootMargin:"0px",threshold:0})},Ae=()=>{!A.value||(A.value.disconnect(),Be(),J.value.forEach((l,n)=>{l&&A.value&&(console.log("\u89C2\u5BDF\u6D88\u606F\u5143\u7D20",l,n),l.setAttribute?(l.setAttribute("data-message-index",n.toString()),A.value.observe(l)):console.warn("\u5143\u7D20\u4E0D\u652F\u6301 setAttribute \u65B9\u6CD5:",l,n))}))},ye=p(()=>{if(o.isInitialized){const l=o.activeChannel;return(l==null?void 0:l.type)==="private"?"session":l==null?void 0:l.type}return"group"}),ee=(l=!1)=>q(this,null,function*(){var L;if((L=X.value)!=null&&L.isTemporary){console.log("\u4E34\u65F6\u9891\u9053\u4E0D\u52A0\u8F7D\u6D88\u606F");return}if(console.log("loadItems",{isPrepending:l},D.value||g.value),D.value||g.value)return;if(l){if(C.value)return;g.value=!0}else{if(P.value)return;D.value=!0}let n=0;l&&F.value&&(n=F.value.scrollHeight);const b=o.activeChannelMessages.length;try{l?yield o.loadMoreNewestMessages(o.activeChannelId):yield o.loadMoreMessages(o.activeChannelId)}catch($){console.error("\u52A0\u8F7D\u6D88\u606F\u5931\u8D25:",$)}yield $e();const T=o.activeChannelMessages.length;if(b===T)l?C.value=!0:P.value=!0;else if(l&&F.value&&f.value){const $=F.value.scrollHeight;console.log("\u4FDD\u6301\u6EDA\u52A8\u4F4D\u7F6E:",{scrollHeightBefore:n,scrollHeightAfter:$,addedHeight:$-n}),f.value.scrollTop=n-$}D.value=!1,g.value=!1,setTimeout(()=>{C.value=!1},1e3)}),ie=p(()=>X.value&&X.value.lastMessage&&typeof X.value.lastMessage.index=="number"&&typeof X.value.lastReadIndex=="number"?X.value.lastMessage.index-X.value.lastReadIndex:0),Xe=l=>{const n=l.target;if(n)try{if(Math.abs(n.scrollTop)<50&&(console.log("\u6EDA\u52A8\u5230\u5E95\u90E8\uFF0C\u51C6\u5907\u52A0\u8F7D\u65B0\u6570\u636E...",Math.abs(n.scrollTop)<50,C.value,g.value),!C.value&&!g.value)){ee(!0);return}console.log("container.scrollTop",n.scrollTop),Math.abs(n.scrollTop)>500?Z.value=!0:Z.value=!1;const b=200;n.scrollHeight-Math.abs(n.scrollTop)-n.clientHeight<b&&(console.log("\u6EDA\u52A8\u5230\u9876\u90E8\uFF0C\u51C6\u5907\u52A0\u8F7D\u66F4\u591A\u6570\u636E..."),ee(!1).catch(T=>{console.error("\u52A0\u8F7D\u66F4\u591A\u6570\u636E\u5931\u8D25:",T)}))}catch(b){console.error("\u6EDA\u52A8\u4E8B\u4EF6\u5904\u7406\u5931\u8D25:",b)}},M=l=>{const n=f.value;!n||l.deltaY>0&&Math.abs(n.scrollTop)<10&&(console.log("\u68C0\u6D4B\u5230\u5411\u4E0B\u6EDA\u52A8\uFF08\u9F20\u6807\u6EDA\u8F6E\uFF09\uFF0C\u51C6\u5907\u52A0\u8F7D\u6700\u65B0\u6D88\u606F..."),!C.value&&!g.value&&ee(!0))},qe=l=>{l.touches.length>0&&(U.value=l.touches[0].clientY)},Oe=l=>{const n=f.value;!n||l.touches.length===0||l.touches[0].clientY-U.value<0&&Math.abs(n.scrollTop)<10&&(console.log("\u68C0\u6D4B\u5230\u5411\u4E0B\u6ED1\u52A8\uFF08\u89E6\u6478\uFF09\uFF0C\u51C6\u5907\u52A0\u8F7D\u6700\u65B0\u6D88\u606F..."),!C.value&&!g.value&&ee(!0))},Ve=()=>q(this,null,function*(){if(u.isAuthorized)if(o.isInitialized)if(o.channels.length===0){console.log("\u{1F504} SimpleTalk\u5DF2\u521D\u59CB\u5316\u4F46\u65E0\u9891\u9053\uFF0C\u5F3A\u5236\u540C\u6B65...");try{console.log("\u2705 \u5F3A\u5236\u540C\u6B65\u5B8C\u6210\uFF0C\u9891\u9053\u6570\u91CF:",o.channels.length)}catch(l){console.error("\u274C \u5F3A\u5236\u540C\u6B65\u5931\u8D25:",l)}}else console.log("\u2705 SimpleTalk\u5DF2\u6B63\u5E38\u521D\u59CB\u5316\uFF0C\u9891\u9053\u6570\u91CF:",o.channels.length);else try{yield o.init()}catch(l){console.error("\u274C MessageList simple-talk \u521D\u59CB\u5316\u5931\u8D25:",l)}}),ke=l=>{};hl(()=>q(this,null,function*(){yield Ve(),Be(),yield $e(),Ba&&document.addEventListener("click",ke)})),Ne(()=>o.isSendRedPacketinProgress,(l,n)=>q(this,null,function*(){if(!l&&n!==void 0)try{oe()}catch(b){console.log(b)}}),{immediate:!0,flush:"post"}),Ne([()=>o.isSetActiveChannelIdInProgress,()=>o.activeChannelMessages.length],b=>q(this,[b],function*([l,n]){var T,L;if(l&&n>0&&((T=o.activeChannel)==null?void 0:T.lastReadIndex)!==void 0){console.log("\u{1F3AF} \u9891\u9053\u5207\u6362\u4E2D\u4E14\u6709\u6D88\u606F\uFF0C\u51C6\u5907\u6EDA\u52A8\u5230\u6700\u540E\u5DF2\u8BFB\u4F4D\u7F6E:",o.activeChannel.lastReadIndex);try{W.value=((L=o.activeChannel.lastMessage)==null?void 0:L.index)-o.activeChannel.lastReadIndex<=5?-1:o.activeChannel.lastReadIndex}catch($){console.error("\u8BBE\u7F6E lastReadIndex \u5931\u8D25:",$),W.value=0}yield $e(),setTimeout(()=>{const $=J.value.get(W.value+1);if(W.value!==0&&$&&f.value){console.log("\u{1F4CD} \u627E\u5230\u6700\u540E\u5DF2\u8BFB\u6D88\u606F\u5143\u7D20\uFF0C\u6EDA\u52A8\u5230\u4F4D\u7F6E:",W);const Y=f.value.getBoundingClientRect(),ue=$.getBoundingClientRect().top-Y.top+f.value.scrollTop;f.value.scrollTop=ue-100}else f.value&&(f.value.scrollTop=0);o.setActiveChannelIdInProgress(!1),Ae()},200)}else console.log("\u{1F3AF} \u9891\u9053\u5207\u6362\u4E2D\u4F46\u65E0\u6D88\u606F\uFF0C\u6216 lastReadIndex \u672A\u5B9A\u4E49\uFF0C\u8DF3\u8FC7\u6EDA\u52A8")}),{immediate:!0}),Ne([()=>o.activeChannelMessages],([l])=>{l&&l.length>0&&(console.log("\u{1F4DD} \u68C0\u6D4B\u5230\u6D88\u606F\u53D8\u5316\uFF0C\u91CD\u65B0\u8BBE\u7F6E\u89C2\u5BDF\u5668"),$e(()=>{setTimeout(()=>{Ae()},100)}))},{immediate:!0,deep:!0}),fl(()=>{Ba&&document.removeEventListener("click",ke),A.value&&A.value.disconnect(),J.value.clear()});function be(l){const n=J.value.get(l);if(n&&f.value){console.log("targetElement",n,l);const b=f.value.getBoundingClientRect(),T=n.getBoundingClientRect().top-b.top+f.value.scrollTop;f.value.scrollTo({top:T-100,behavior:"smooth"}),setTimeout(()=>{n&&(n.classList.add("message-highlight-flash"),setTimeout(()=>{n.classList.remove("message-highlight-flash")},800))},500),console.log(`\u{1F4CD} \u6EDA\u52A8\u5230\u6D88\u606F\u7D22\u5F15: ${l}`)}else console.warn(`\u26A0\uFE0F \u65E0\u6CD5\u627E\u5230\u7D22\u5F15\u4E3A ${l} \u7684\u6D88\u606F\u5143\u7D20`),o.loadMessageByIndex(l).then(()=>{ee(!0)}).catch(b=>{console.error("\u52A0\u8F7D\u6307\u5B9A\u7D22\u5F15\u6D88\u606F\u5931\u8D25:",b)})}function Ge(l){const n=document.getElementById(l.toString());if(n&&se.value){const b=n.offsetTop-n.clientHeight;se.value.scrollTo({top:b,behavior:"smooth"}),setTimeout(()=>{n&&(n.classList.add("message-highlight-flash"),setTimeout(()=>{n.classList.remove("message-highlight-flash")},800))},500),console.log(`\u{1F4CD} \u6EDA\u52A8\u5230\u65F6\u95F4\u6233: ${l}`)}else console.warn(`\u26A0\uFE0F \u65E0\u6CD5\u627E\u5230\u65F6\u95F4\u6233\u4E3A ${l} \u7684\u6D88\u606F\u5143\u7D20`)}function Re(l){return q(this,null,function*(){const n=kl();console.log("data12313",l);const b={body:JSON.stringify(l),path:`bc1p20k3x2c4mglfxr5wa5sgtgechwstpld80kru2cg4gmm4urvuaqqsvapxu0:/protocols/${j.ShareChatMessage}`,flag:"metaid",version:"1.0.1",operation:"create",contentType:"application/json",encryption:"0",encoding:"utf-8"},T=yield ne.createPin(b,!0,!1).catch(L=>{n.close(),bl.error(L.message)});T?(n.close(),I.isShowShareSuccessModal=!0):T===null&&n.close()})}return x({scrollToIndex:be,scrollToTimeStamp:Ge,scrollToMessagesBottom:oe}),(l,n)=>{var $,Y,ue;const b=je,T=Fe,L=$a;return i(),d(ce,null,[ge(t("div",Ms,[v(qa)],512),[[pe,e(u).isAuthorized&&(e(I).isShowMessagesLoading||e(o).isInitialized===!1||e(o).isSetActiveChannelIdInProgress||e(o).activeChannelMessages.length===0&&((Y=($=e(o).activeChannel)==null?void 0:$.lastMessage)==null?void 0:Y.index)>0)]]),t("div",{class:"h-full relative overflow-y-auto",ref_key:"messagesScroll",ref:se,id:"messagesScroll"},[((ue=e(X))==null?void 0:ue.type)==="private"&&!e(X).publicKeyStr?(i(),z(b,{key:0,title:l.$t("user_private_chat_unsupport"),type:"error","show-icon":"",closable:!1},null,8,["title"])):h("v-if",!0),t("div",Ts,[v(fs),v(Is),t("div",{class:"list-container",ref_key:"listContainer",ref:f,onScrollPassive:Xe,onWheelPassive:M,onTouchstartPassive:qe,onTouchmovePassive:Oe},[h(" \u9876\u90E8\u52A0\u8F7D\u6307\u793A\u5668 "),ge(t("div",Ss,Ds,512),[[pe,D.value]]),h(" \u5217\u8868\u9879\u5C06\u88AB\u6E32\u67D3\u5230\u8FD9\u91CC "),h(" ref \u7528\u4E8E\u5728\u4EE3\u7801\u4E2D\u76F4\u63A5\u8BBF\u95EE\u8FD9\u4E2A DOM \u5143\u7D20 "),t("div",{ref_key:"listWrapper",ref:F},[h(" \u4F7F\u7528 v-for \u5FAA\u73AF\u6E32\u67D3\u5217\u8868\u9879 "),e(ye)==="group"||e(ye)==="sub-group"?(i(!0),d(ce,{key:0},ze(e(o).activeChannelMessages,a=>(i(),z(Ml,{key:a.timestamp,message:a,id:a.timestamp,"data-message-index":a.index,"data-message-mockId":a.mockId||"",ref_for:!0,ref:r=>fe(r,a),onQuote:n[0]||(n[0]=r=>c("quote",r)),onToBuzz:Re,onToTimeStamp:be,lastReadIndex:W.value},null,8,["message","id","data-message-index","data-message-mockId","lastReadIndex"]))),128)):(i(!0),d(ce,{key:1},ze(e(o).activeChannelMessages,a=>(i(),z(ls,{key:a.timestamp,message:a,"data-message-mockId":a.mockId||"","data-message-index":a.index,ref_for:!0,ref:r=>fe(r,a),onQuote:n[1]||(n[1]=r=>c("quote",r)),id:a.timestamp,onToBuzz:Re,onToTimeStamp:be,lastReadIndex:W.value},null,8,["message","data-message-mockId","data-message-index","id","lastReadIndex"]))),128)),v(Ca,{name:"fade-scroll-button",mode:"out-in",persisted:""},{default:Q(()=>[ge(t("div",{class:"scroll-to-bottom-button cursor-pointer",onClick:n[2]||(n[2]=a=>oe())},[e(ie)>0?(i(),z(L,{key:0,value:e(ie),class:"item",max:9999,"show-zero":!1},{default:Q(()=>[t("div",$s,[v(T,{class:"text-dark-800 dark:text-white"},{default:Q(()=>[v(e(Aa))]),_:1})])]),_:1},8,["value"])):(i(),d("div",Ps,[v(T,{class:"text-dark-800 dark:text-white"},{default:Q(()=>[v(e(Aa))]),_:1})]))],512),[[pe,Z.value||e(ie)>0||e(de)]])]),_:1})],512),t("div",{class:"message-list-bottom-spacer",ref_key:"bottomSpacer",ref:te},null,512),h(" \u5E95\u90E8\u52A0\u8F7D\u6307\u793A\u5668 "),ge(t("div",Bs,Rs,512),[[pe,g.value]])],544)])],512),v(Tl,{modelValue:V.value,"onUpdate:modelValue":n[3]||(n[3]=a=>V.value=a),repostTxId:re.value,ref_key:"PublishRef",ref:B},null,8,["modelValue","repostTxId"])],64)}}});za=Le(zs,[["__scopeId","data-v-d2ea2ab8"]])}));export{El as __tla,za as default};
